__author__ = 'arko1k'


from shapely.geometry import Polygon, LineString
from matplotlib import pyplot as plt
import math
import collections


def self_intersection_point(ordered_polygon, initial_search_depth=None):
    if ordered_polygon[0][0] == ordered_polygon[-1][0] and ordered_polygon[0][1] == ordered_polygon[-1][1]:
        print('here')
        ordered_polygon = collections.deque(ordered_polygon[:-1]) # Removing the redundant point.
    else:
        ordered_polygon = collections.deque(ordered_polygon)
    ordered_polygon.rotate(10) # Starting search from the back as most self-intersects happen at the joining of beginning and end.
    drawing = []
    size = len(ordered_polygon)
    if initial_search_depth:
        search_depth = initial_search_depth
    else:
        search_depth = size
    for i in range(0, size):
        if i == size - 1:
            end = 0
        else:
            end = i + 1
        drawing.append(LineString([ordered_polygon[i], ordered_polygon[end]]))
        for j in range(2, search_depth):
            e2 = i - j
            if e2 < 0:
                break
            intersection_point = drawing[i].intersection(drawing[e2])
            if intersection_point:
                return [intersection_point.x, intersection_point.y]
    # Is search still unsuccessful, compare all edges - O(n^2):
    for i in range(2, size):
        if i == size - 1:
            end = 0
        else:
            end = i + 1
        for j in range(initial_search_depth, size):
            e2 = i - j
            if e2 < 0:
                break
            intersection_point = drawing[i].intersection(drawing[e2])
            if intersection_point:
                return [intersection_point.x, intersection_point.y]


poly = [ [ 77.6254071, 12.939884 ], [ 77.6255329, 12.9399961 ], [ 77.6256759, 12.9401489 ], [ 77.6257939, 12.9402641 ], [ 77.6258759, 12.940322 ], [ 77.6258971, 12.9403369 ], [ 77.626135, 12.940428 ], [ 77.6263259, 12.940482 ], [ 77.626457, 12.940522 ], [ 77.62655, 12.9405499 ], [ 77.626738, 12.94062 ], [ 77.626806, 12.9406458 ], [ 77.6269191, 12.9406811 ], [ 77.626946, 12.9406891 ], [ 77.627046, 12.940718 ], [ 77.6270081, 12.941131 ], [ 77.626971, 12.941365 ], [ 77.6268799, 12.941447 ], [ 77.6266089, 12.9415509 ], [ 77.6262471, 12.9417221 ], [ 77.6262049, 12.9418161 ], [ 77.6261299, 12.942841 ], [ 77.62612, 12.9432661 ], [ 77.6260931, 12.9442519 ], [ 77.6260719, 12.944392 ], [ 77.6259759, 12.944547 ], [ 77.62596, 12.944558 ], [ 77.625662, 12.944946 ], [ 77.625444, 12.945149 ], [ 77.6249391, 12.945439 ], [ 77.624274, 12.945812 ], [ 77.623981, 12.945989 ], [ 77.623976, 12.9462171 ], [ 77.6237601, 12.9462071 ], [ 77.6237419, 12.9463121 ], [ 77.623376, 12.9468599 ], [ 77.6230351, 12.94739 ], [ 77.622945, 12.9474569 ], [ 77.622826, 12.9474569 ], [ 77.622404, 12.9480799 ], [ 77.622027, 12.948646 ], [ 77.6214991, 12.949501 ], [ 77.6211461, 12.949663 ], [ 77.6208139, 12.9498301 ], [ 77.6206851, 12.9498949 ], [ 77.620631, 12.949918 ], [ 77.620577, 12.9498149 ], [ 77.6205539, 12.949776 ], [ 77.6202719, 12.949277 ], [ 77.620231, 12.949191 ], [ 77.6201499, 12.94903 ], [ 77.620056, 12.9488671 ], [ 77.620026, 12.9488091 ], [ 77.619624, 12.9480691 ], [ 77.619417, 12.947701 ], [ 77.619285, 12.9474679 ], [ 77.619266, 12.947433 ], [ 77.619162, 12.947238 ], [ 77.619099, 12.947119 ], [ 77.619002, 12.9469379 ], [ 77.6188448, 12.9466509 ], [ 77.618641, 12.946273 ], [ 77.618564, 12.946081 ], [ 77.618532, 12.9460029 ], [ 77.618453, 12.946026 ], [ 77.618424, 12.9460409 ], [ 77.6183181, 12.9460941 ], [ 77.618295, 12.9461061 ], [ 77.6182439, 12.946131 ], [ 77.6182041, 12.945947 ], [ 77.618109, 12.9456209 ], [ 77.6181011, 12.9455971 ], [ 77.6180479, 12.9454219 ], [ 77.6178901, 12.9454869 ], [ 77.617867, 12.945497 ], [ 77.6177, 12.9455651 ], [ 77.6176769, 12.945575 ], [ 77.6175159, 12.945652 ], [ 77.617382, 12.9457159 ], [ 77.61735, 12.9457311 ], [ 77.6172121, 12.945811 ], [ 77.617157, 12.945843 ], [ 77.617061, 12.9458971 ], [ 77.616755, 12.946066 ], [ 77.616594, 12.946158 ], [ 77.616273, 12.9463121 ], [ 77.6162421, 12.9461959 ], [ 77.61624, 12.946135 ], [ 77.616247, 12.946077 ], [ 77.616287, 12.9459129 ], [ 77.616368, 12.9456761 ], [ 77.6164419, 12.9454599 ], [ 77.616451, 12.945434 ], [ 77.6165279, 12.945241 ], [ 77.616597, 12.9451391 ], [ 77.616665, 12.9450691 ], [ 77.616746, 12.945 ], [ 77.6167951, 12.9449581 ], [ 77.6168591, 12.944912 ], [ 77.6166419, 12.9443379 ], [ 77.616575, 12.944198 ], [ 77.616518, 12.944122 ], [ 77.6165029, 12.9441019 ], [ 77.616244, 12.943825 ], [ 77.6161131, 12.943717 ], [ 77.615841, 12.943655 ], [ 77.6159069, 12.9417679 ], [ 77.6142304, 12.9426552 ], [ 77.6116681, 12.9434101 ], [ 77.6115624, 12.9428618 ], [ 77.6120456, 12.9419003 ], [ 77.6130539, 12.940071 ], [ 77.612482, 12.939762 ], [ 77.6125, 12.939701 ], [ 77.6125049, 12.939645 ], [ 77.612503, 12.939606 ], [ 77.612484, 12.9395119 ], [ 77.612445, 12.939473 ], [ 77.612363, 12.9394291 ], [ 77.612307, 12.9394311 ], [ 77.6122409, 12.9394539 ], [ 77.612214, 12.9394869 ], [ 77.612183, 12.939536 ], [ 77.61216, 12.9395961 ], [ 77.611926, 12.9394519 ], [ 77.61188, 12.939423 ], [ 77.6115459, 12.939208 ], [ 77.6112349, 12.938966 ], [ 77.6102941, 12.9382399 ], [ 77.610254, 12.938209 ], [ 77.610435, 12.937875 ], [ 77.61072, 12.9373379 ], [ 77.6109681, 12.9368961 ], [ 77.61098, 12.936873 ], [ 77.6110039, 12.936825 ], [ 77.6111679, 12.9364931 ], [ 77.611281, 12.9362711 ], [ 77.611569, 12.935734 ], [ 77.6116451, 12.935593 ], [ 77.611807, 12.935316 ], [ 77.6121089, 12.934768 ], [ 77.612335, 12.9343941 ], [ 77.612363, 12.934347 ], [ 77.612707, 12.933725 ], [ 77.6135089, 12.932298 ], [ 77.613761, 12.9318449 ], [ 77.6138239, 12.93171 ], [ 77.613908, 12.9315299 ], [ 77.614192, 12.930982 ], [ 77.614707, 12.93011 ], [ 77.6148401, 12.9299261 ], [ 77.615017, 12.929702 ], [ 77.6151329, 12.9295531 ], [ 77.615238, 12.929404 ], [ 77.615334, 12.929251 ], [ 77.61618, 12.9278549 ], [ 77.61716, 12.926238 ], [ 77.6172121, 12.9261481 ], [ 77.6173621, 12.9258941 ], [ 77.6173809, 12.925864 ], [ 77.6177799, 12.925239 ], [ 77.618117, 12.9246971 ], [ 77.6181439, 12.924646 ], [ 77.618188, 12.924566 ], [ 77.618278, 12.9244 ], [ 77.618527, 12.9240111 ], [ 77.618559, 12.923958 ], [ 77.618821, 12.923538 ], [ 77.618984, 12.923276 ], [ 77.619009, 12.923237 ], [ 77.619312, 12.922744 ], [ 77.619517, 12.9224119 ], [ 77.6199539, 12.9217121 ], [ 77.620158, 12.921345 ], [ 77.620238, 12.921153 ], [ 77.6202569, 12.9211068 ], [ 77.6202749, 12.921078 ], [ 77.6203289, 12.9209899 ], [ 77.6209031, 12.920041 ], [ 77.620969, 12.919946 ], [ 77.621223, 12.919556 ], [ 77.621269, 12.919516 ], [ 77.6214601, 12.919351 ], [ 77.6215991, 12.919204 ], [ 77.6216241, 12.919177 ], [ 77.622222, 12.918364 ], [ 77.6225599, 12.9179061 ], [ 77.622683, 12.917798 ], [ 77.6227929, 12.91771 ], [ 77.6229029, 12.9176399 ], [ 77.6230459, 12.9175961 ], [ 77.6232408, 12.917572 ], [ 77.6234741, 12.917579 ], [ 77.6237569, 12.9176451 ], [ 77.624205, 12.9177191 ], [ 77.624669, 12.9178011 ], [ 77.624777, 12.91782 ], [ 77.62487, 12.9178271 ], [ 77.624931, 12.9178281 ], [ 77.625338, 12.917826 ], [ 77.6255571, 12.917797 ], [ 77.6258611, 12.917741 ], [ 77.626228, 12.917621 ], [ 77.627111, 12.917357 ], [ 77.628351, 12.917012 ], [ 77.628676, 12.916971 ], [ 77.6292001, 12.916904 ], [ 77.6298119, 12.9168748 ], [ 77.6299761, 12.916864 ], [ 77.6302801, 12.916842 ], [ 77.631662, 12.9167481 ], [ 77.631687, 12.916745 ], [ 77.632322, 12.916675 ], [ 77.6337119, 12.9165311 ], [ 77.6347417, 12.916524 ], [ 77.6360529, 12.9182896 ], [ 77.6382291, 12.9179191 ], [ 77.638249, 12.918497 ], [ 77.638285, 12.919237 ], [ 77.6383011, 12.9196549 ], [ 77.6383151, 12.919768 ], [ 77.63836, 12.9200549 ], [ 77.638374, 12.9201249 ], [ 77.638386, 12.92018 ], [ 77.638399, 12.920259 ], [ 77.638415, 12.920327 ], [ 77.638583, 12.9208971 ], [ 77.638614, 12.9210041 ], [ 77.6386951, 12.921276 ], [ 77.638754, 12.921478 ], [ 77.6387631, 12.921507 ], [ 77.638784, 12.921554 ], [ 77.638895, 12.921768 ], [ 77.638966, 12.921895 ], [ 77.638995, 12.921946 ], [ 77.6391109, 12.922166 ], [ 77.639267, 12.92246 ], [ 77.6394041, 12.922762 ], [ 77.639467, 12.9228988 ], [ 77.6396089, 12.9232109 ], [ 77.63969, 12.923382 ], [ 77.6397411, 12.92349 ], [ 77.6397629, 12.923554 ], [ 77.6397731, 12.923585 ], [ 77.6397849, 12.9236419 ], [ 77.6398091, 12.923758 ], [ 77.6398161, 12.9237939 ], [ 77.6398231, 12.9238259 ], [ 77.6398411, 12.9239159 ], [ 77.639948, 12.923873 ], [ 77.639973, 12.9238629 ], [ 77.640373, 12.9237071 ], [ 77.640638, 12.9236059 ], [ 77.6406981, 12.9235821 ], [ 77.6408161, 12.923536 ], [ 77.6410921, 12.9234319 ], [ 77.641219, 12.923393 ], [ 77.6412899, 12.923391 ], [ 77.6413751, 12.923398 ], [ 77.64147, 12.9234179 ], [ 77.6418, 12.923513 ], [ 77.6420561, 12.9235869 ], [ 77.642308, 12.923655 ], [ 77.6424751, 12.9236919 ], [ 77.6430479, 12.92384 ], [ 77.643649, 12.9240159 ], [ 77.6442829, 12.9242079 ], [ 77.644599, 12.924319 ], [ 77.6446239, 12.9243278 ], [ 77.6448349, 12.9243889 ], [ 77.6450109, 12.9244359 ], [ 77.6451259, 12.924458 ], [ 77.645231, 12.924474 ], [ 77.645454, 12.9244911 ], [ 77.645776, 12.9244951 ], [ 77.646246, 12.924498 ], [ 77.646572, 12.92451 ], [ 77.647017, 12.924549 ], [ 77.6472631, 12.92458 ], [ 77.6475719, 12.9246149 ], [ 77.647865, 12.924626 ], [ 77.6481699, 12.92463 ], [ 77.6484221, 12.9246471 ], [ 77.6489921, 12.9246921 ], [ 77.6491321, 12.924701 ], [ 77.6493449, 12.924683 ], [ 77.649604, 12.9246601 ], [ 77.649716, 12.9246209 ], [ 77.649878, 12.9245911 ], [ 77.6500191, 12.924555 ], [ 77.6501551, 12.9245089 ], [ 77.6503199, 12.9244341 ], [ 77.6511179, 12.9243539 ], [ 77.651754, 12.924277 ], [ 77.651752, 12.924391 ], [ 77.6518751, 12.9249221 ], [ 77.651941, 12.9250761 ], [ 77.652567, 12.925003 ], [ 77.652814, 12.925425 ], [ 77.652711, 12.926969 ], [ 77.653102, 12.927471 ], [ 77.653555, 12.928434 ], [ 77.653932, 12.929405 ], [ 77.6541309, 12.9299179 ], [ 77.653349, 12.929838 ], [ 77.6521129, 12.9289661 ], [ 77.6513111, 12.9290761 ], [ 77.6506941, 12.928715 ], [ 77.648697, 12.9274111 ], [ 77.648388, 12.9273899 ], [ 77.647987, 12.9276209 ], [ 77.647616, 12.927972 ], [ 77.6471919, 12.9279659 ], [ 77.6464559, 12.928492 ], [ 77.646299, 12.928664 ], [ 77.646021, 12.928965 ], [ 77.6455841, 12.9293621 ], [ 77.6452861, 12.9292759 ], [ 77.6447811, 12.9289001 ], [ 77.644452, 12.9286501 ], [ 77.6443439, 12.928604 ], [ 77.6441789, 12.9285641 ], [ 77.6439169, 12.928594 ], [ 77.643768, 12.9286439 ], [ 77.6425479, 12.929121 ], [ 77.6420739, 12.9293059 ], [ 77.642115, 12.929532 ], [ 77.6420849, 12.929682 ], [ 77.641987, 12.929964 ], [ 77.641627, 12.9302141 ], [ 77.641313, 12.9302341 ], [ 77.641061, 12.9301091 ], [ 77.640886, 12.9300788 ], [ 77.640593, 12.930069 ], [ 77.6395769, 12.9305751 ], [ 77.6392939, 12.9306921 ], [ 77.639112, 12.9307709 ], [ 77.638952, 12.93084 ], [ 77.6388959, 12.9308599 ], [ 77.6371981, 12.929221 ], [ 77.636934, 12.9286231 ], [ 77.6370909, 12.928403 ], [ 77.636892, 12.928058 ], [ 77.6365461, 12.9283069 ], [ 77.6365211, 12.928322 ], [ 77.6364819, 12.9283439 ], [ 77.6361271, 12.9285279 ], [ 77.635972, 12.9286079 ], [ 77.6358939, 12.9286451 ], [ 77.6352141, 12.92899 ], [ 77.635073, 12.929061 ], [ 77.634859, 12.9291659 ], [ 77.6346489, 12.9292719 ], [ 77.634468, 12.929371 ], [ 77.634265, 12.929483 ], [ 77.6341979, 12.9295129 ], [ 77.6340691, 12.9295661 ], [ 77.6340441, 12.9295759 ], [ 77.6338479, 12.929654 ], [ 77.633642, 12.92974 ], [ 77.633527, 12.929789 ], [ 77.633487, 12.929801 ], [ 77.6331389, 12.9298359 ], [ 77.633111, 12.930141 ], [ 77.6330849, 12.930254 ], [ 77.6330381, 12.93044 ], [ 77.632933, 12.930829 ], [ 77.632633, 12.9313981 ], [ 77.632406, 12.9317281 ], [ 77.6318759, 12.93225 ], [ 77.6318219, 12.932302 ], [ 77.6315649, 12.9325599 ], [ 77.6314039, 12.93272 ], [ 77.630175, 12.9339039 ], [ 77.629685, 12.934454 ], [ 77.629784, 12.934528 ], [ 77.629942, 12.934643 ], [ 77.6300471, 12.934719 ], [ 77.6301839, 12.9348189 ], [ 77.630061, 12.935118 ], [ 77.6298511, 12.9356511 ], [ 77.6297939, 12.935835 ], [ 77.629767, 12.9359489 ], [ 77.629756, 12.9360139 ], [ 77.629771, 12.9360429 ], [ 77.629818, 12.9360621 ], [ 77.6296401, 12.9364541 ], [ 77.62923, 12.937366 ], [ 77.629123, 12.9376101 ], [ 77.6288781, 12.9375601 ], [ 77.628729, 12.9382248 ], [ 77.628704, 12.9383319 ], [ 77.628641, 12.938307 ], [ 77.6285311, 12.938263 ], [ 77.62843, 12.9382221 ], [ 77.6284741, 12.938123 ], [ 77.628297, 12.938049 ], [ 77.628275, 12.9380371 ], [ 77.6280699, 12.937931 ], [ 77.627768, 12.9377711 ], [ 77.6276521, 12.937704 ], [ 77.627543, 12.937637 ], [ 77.6273449, 12.937497 ], [ 77.6271981, 12.937394 ], [ 77.6269699, 12.937222 ], [ 77.6269, 12.9373069 ], [ 77.626761, 12.937476 ], [ 77.6266339, 12.937623 ], [ 77.626603, 12.937661 ], [ 77.626078, 12.9383561 ], [ 77.6258759, 12.9388119 ], [ 77.6258369, 12.938905 ], [ 77.625685, 12.9392611 ], [ 77.6254649, 12.939773 ], [ 77.6254071, 12.939884 ] ]
print(self_intersection_point(poly, 20))